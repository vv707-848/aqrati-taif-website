<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Ø§Ù„Ù†Ø®Ø¨Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© â€” Ù…Ù†ØµØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Ø§Ù„Ù†Ø®Ø¨Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© - Ù…Ù†ØµØ© Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª (ØµÙØ­Ø§Øª Ø®Ø§ØµØ©: Ø¥Ø¶Ø§ÙØ©ØŒ ØªÙØ§ØµÙŠÙ„ØŒ Ù„ÙˆØ­Ø© Ù…Ø¯ÙŠØ±)" />
  <style>
    /* ===============================
       RESET / BASE
       =============================== */
    * { box-sizing: border-box; }
    html,body { height:100%; }
    body {
      margin:0;
      font-family: "Cairo", "Segoe UI", Tahoma, Arial, sans-serif;
      background: linear-gradient(180deg,#f3f6fb 0%, #eef4f9 100%);
      color:#072026;
      direction: rtl;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a { color:inherit; text-decoration:none; }
    button { cursor:pointer; }

    /* ===============================
       TOPBAR
       =============================== */
    .topbar {
      position:sticky;
      top:0;
      z-index:999;
      display:flex;
      align-items:center;
      gap:12px;
      padding:12px 20px;
      background: linear-gradient(90deg,#0f4c5ccc,#0b6f6fcc);
      color:#fff;
      box-shadow: 0 10px 30px rgba(5,20,30,0.12);
    }
    .brand {
      display:flex;
      align-items:center;
      gap:12px;
      margin-right:auto;
    }
    .logo {
      width:56px;
      height:56px;
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      color:#072026;
      background: linear-gradient(135deg,#ffd166,#ef476f);
      box-shadow:0 10px 28px rgba(0,0,0,0.12);
    }
    .site-title { font-weight:900; font-size:1.15rem; }
    .site-sub { font-size:0.8rem; opacity:0.92; }

    .top-actions { display:flex; gap:8px; align-items:center; }
    .btn {
      border:none; padding:8px 12px; border-radius:10px; font-weight:800; transition:all .14s ease;
      background: rgba(255,255,255,0.08); color:white;
    }
    .btn:hover { transform:translateY(-3px); background: rgba(255,255,255,0.12); }
    .btn-primary { background: linear-gradient(90deg,#ff8a65,#ffb86b); color:#112; box-shadow:0 8px 22px rgba(255,120,120,0.12); }
    .btn-ghost { background:transparent; border:1px solid rgba(255,255,255,0.08); color:white; }
    .search-wrap {
      display:flex; gap:8px; align-items:center; background: rgba(255,255,255,0.06);
      padding:8px 10px; border-radius:10px; min-width:280px;
    }
    .search-wrap input { background:transparent; border:none; outline:none; color:white; width:220px; }

    /* ===============================
       LAYOUT / CONTAINER
       =============================== */
    .container { max-width:1200px; margin:28px auto; padding:0 16px; }

    /* ===============================
       HERO
       =============================== */
    .hero {
      display:flex; gap:22px; align-items:center; justify-content:space-between;
      background: linear-gradient(180deg,#ffffff,#f7fbff);
      border-radius:14px; padding:18px;
      box-shadow:0 12px 30px rgba(12,28,36,0.06);
    }
    .hero-left { flex:1; min-width:280px; }
    .hero-right { width:380px; display:flex; justify-content:center; }

    .hero h2 { margin:0 0 8px; font-size:1.6rem; color:#043; }
    .hero p { margin:0 0 14px; color:#556; }

    .quick-actions { display:flex; gap:10px; flex-wrap:wrap; margin-top:8px; }
    .quick-card {
      background: linear-gradient(180deg,#fff,#f6fdff);
      border-radius:12px; padding:10px; min-width:170px;
      display:flex; gap:10px; align-items:center; box-shadow:0 8px 18px rgba(10,20,30,0.03);
      border:1px solid rgba(12,28,36,0.03);
    }
    .quick-icon { width:46px; height:46px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:900; color:#042; background:linear-gradient(135deg,#6dd3ff,#87f0d8); }

    /* ===============================
       CATEGORIES (ÙØ¦Ø§Øª) â€” framed style
       =============================== */
    .categories {
      display:flex; gap:12px; flex-wrap:wrap; margin:18px 0; align-items:center;
    }
    .cat-frame {
      display:flex; align-items:center; gap:12px; padding:12px 14px; border-radius:12px;
      background: linear-gradient(180deg,#fff,#fbfeff);
      border:2px solid rgba(6,20,24,0.04);
      box-shadow:0 10px 26px rgba(8,20,28,0.04);
      cursor:pointer; transition: transform .12s ease, box-shadow .12s ease;
      min-width:140px;
    }
    .cat-frame:hover { transform: translateY(-6px); box-shadow:0 22px 48px rgba(6,20,24,0.06); }
    .cat-icon { width:56px; height:56px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:900; color:#fff; }
    .cat-title { font-weight:900; font-size:0.98rem; color:#043; }
    .cat-sub { font-size:0.82rem; color:#556; }

    .cat-frame.active { border-color: #ffb36b; box-shadow:0 22px 48px rgba(255,179,107,0.12); transform:translateY(-6px); }

    /* ===============================
       PROPERTIES GRID / CARD
       =============================== */
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:18px; }
    .card {
      background: linear-gradient(180deg,#fff,#fbfeff);
      border-radius:14px; overflow:hidden; border:1px solid rgba(10,20,30,0.04);
      box-shadow:0 10px 28px rgba(12,28,36,0.06); transition: transform .18s ease, box-shadow .18s ease;
      position:relative;
    }
    .card:hover { transform: translateY(-10px); box-shadow:0 26px 60px rgba(12,28,36,0.1); }
    .card-media { height:200px; overflow:hidden; position:relative; }
    .card-media img { width:100%; height:100%; object-fit:cover; display:block; transition: transform .6s cubic-bezier(.2,.8,.25,1); }
    .card:hover .card-media img { transform: scale(1.06); }

    .ribbon {
      position:absolute; top:14px; right:14px; padding:8px 10px; border-radius:10px; font-weight:900; color:white;
      box-shadow:0 8px 18px rgba(0,0,0,0.12);
    }
    .ribbon.basic { background: linear-gradient(90deg,#9FB8FF,#7EC6FF); }
    .ribbon.featured { background: linear-gradient(90deg,#ffd166,#ff8a65); }
    .ribbon.premium { background: linear-gradient(90deg,#b388ff,#7e57c2); }

    .card-body { padding:14px; }
    .card-title { margin:0 0 8px; font-weight:900; color:#053; font-size:1.02rem; }
    .card-loc { color:#566; font-size:0.9rem; margin-bottom:10px; }
    .card-meta { display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .price { font-weight:900; color:#ff6b6b; }
    .meta-small { color:#667; }

    .card-footer { display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:12px; }
    .btn-small { padding:8px 12px; border-radius:10px; font-weight:900; border:none; }
    .btn-view { background:linear-gradient(90deg,#e6f7ff,#dff3ff); color:#072; border:1px solid rgba(6,20,24,0.04); }
    .btn-contact { background:linear-gradient(90deg,#25d366,#128c7e); color:white; }

    /* ===============================
       DETAIL PAGE (ØµÙØ­Ø© Ù…Ù†ÙØµÙ„Ø©)
       =============================== */
    .page {
      display:none;
      animation: fadeIn .18s ease;
    }
    .page.show { display:block; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity:1; transform:none; } }

    .detail-page {
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:18px;
      margin-top:18px;
    }
    .detail-gallery {
      background:linear-gradient(180deg,#fff,#fbfeff);
      border-radius:12px; padding:12px; border:1px solid rgba(8,20,28,0.03);
      box-shadow:0 10px 30px rgba(12,28,36,0.06);
    }
    .detail-main { height:460px; border-radius:12px; overflow:hidden; background:#e6eef3; display:flex; align-items:center; justify-content:center; }
    .detail-main img { width:100%; height:100%; object-fit:cover; }
    .detail-thumbs { display:flex; gap:10px; margin-top:12px; }
    .detail-thumbs img { width:120px; height:84px; object-fit:cover; border-radius:8px; cursor:pointer; border:2px solid transparent; transition: border .12s; }
    .detail-thumbs img.active { border-color:#ffb36b; }

    .detail-info {
      background:linear-gradient(180deg,#fff,#fbfeff);
      border-radius:12px; padding:16px; border:1px solid rgba(8,20,28,0.03);
      box-shadow:0 10px 30px rgba(12,28,36,0.06);
      display:flex; flex-direction:column; gap:12px;
    }
    .detail-info h3 { margin:0; color:#012; font-weight:900; }
    .info-row { display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .info-box { padding:12px; border-radius:10px; background:linear-gradient(180deg,#fff,#f7fafc); border:1px solid rgba(8,20,28,0.03); }
    .label { font-weight:900; color:#233; margin-bottom:6px; display:block; }

    .back-home { display:inline-block; margin-top:6px; color:#556; font-weight:900; cursor:pointer; }

    /* ===============================
       ADD PAGE (ØµÙØ­Ø© Ù…Ø³ØªÙ‚Ù„Ø©)
       =============================== */
    .add-page {
      margin-top:18px;
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:18px;
    }
    .form-grid { display:grid; gap:12px; grid-template-columns:1fr; }
    .input, textarea, select {
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e6eef3; outline:none; font-size:0.95rem;
    }
    textarea { min-height:140px; resize:vertical; }
    .images-preview { display:flex; gap:8px; margin-top:6px; flex-wrap:wrap; }
    .img-slot { width:140px; height:100px; border-radius:8px; background:#f6fafc; border:1px dashed #dbe8ef; display:flex; align-items:center; justify-content:center; overflow:hidden; }

    .note { color:#566; font-size:0.9rem; }

    /* ===============================
       ADMIN PAGE (ØµÙØ­Ø© Ù…Ù†ÙØµÙ„Ø© Ù…Ø­ØªØ±ÙØ©)
       =============================== */
    #adminPage {
      display:none; position:fixed; inset:0; z-index:1400; padding:28px; background:linear-gradient(180deg,#f4f6f8, #eef3f6); overflow:auto;
    }
    .admin-shell { max-width:1200px; margin:0 auto; background:white; border-radius:12px; padding:18px; box-shadow:0 14px 38px rgba(12,28,36,0.12); }
    .admin-head { display:flex; justify-content:space-between; gap:12px; align-items:center; margin-bottom:12px; }
    .tabs { display:flex; gap:8px; }
    .tab { padding:8px 12px; border-radius:10px; background:linear-gradient(180deg,#fff,#fbfeff); border:1px solid #eef3f6; font-weight:900; cursor:pointer; }
    .tab.active { background:linear-gradient(90deg,#ffd166,#ff7a7a); color:#102; transform:translateY(-3px); }

    .admin-grid { display:grid; gap:16px; margin-top:12px; }
    .admin-table { width:100%; border-collapse:collapse; }
    .admin-table th, .admin-table td { padding:10px; border-bottom:1px solid #f2f6f8; text-align:right; }

    .admin-actions button { margin-left:8px; }

    /* ===============================
       Footer / responsive
       =============================== */
    footer { padding:22px; text-align:center; color:#567; font-size:0.95rem; margin-top:30px; }

    @media (max-width:980px){
      .detail-page, .add-page { grid-template-columns: 1fr; }
      .hero-right { display:none; }
      .grid { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); }
      .topbar { padding:10px; }
    }
  </style>
</head>
<body>

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="brand">
      <div class="logo" id="logoText">Ù†Ø®</div>
      <div>
        <div class="site-title" id="siteNameDisplay">Ø§Ù„Ù†Ø®Ø¨Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</div>
        <div class="site-sub">Ù…Ù†ØµØ© Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</div>
      </div>
    </div>

    <div class="search-wrap" title="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.95;margin-left:6px">
        <path d="M21 21l-4.35-4.35" stroke="white" stroke-width="1.6" stroke-linecap="round"/>
        <circle cx="11" cy="11" r="6" stroke="white" stroke-width="1.6"/>
      </svg>
      <input id="globalSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†ÙˆØ§Ù†ØŒ Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ ÙˆØµÙ..." />
    </div>

    <div class="top-actions">
      <button class="btn" id="btnHome" onclick="goHome()">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <button class="btn" id="btnShowAdd">Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø±</button>
      <button class="btn" id="btnLogin">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
      <button class="btn" id="btnSiteEdit" style="display:none;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
    </div>
  </div>

  <!-- MAIN CONTAINER -->
  <div class="container" id="mainContent">

    <!-- HERO -->
    <section class="hero" aria-label="Ù…Ù‚Ø¯Ù…Ø©">
      <div class="hero-left">
        <h2>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù†Ø®Ø¨Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</h2>
        <p>Ù…Ù†ØµØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª â€” Ø£Ø¶Ù Ø¹Ø±Ø¶Ùƒ Ø§Ù„Ø¢Ù† ÙˆØ³Ù†ØªÙˆÙ„Ù‰ Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±.</p>

        <div class="quick-actions">
          <div class="quick-card"><div class="quick-icon">ğŸ </div><div><div style="font-weight:900">Ø¹Ø±ÙˆØ¶ Ù…ØªÙ†ÙˆØ¹Ø©</div><div class="note">ÙÙ„Ù„ØŒ Ø´Ù‚Ù‚ØŒ Ø£Ø±Ø§Ø¶ÙŠØŒ Ø§Ø³ØªØ±Ø§Ø­Ø§Øª</div></div></div>
          <div class="quick-card"><div class="quick-icon">ğŸ”’</div><div><div style="font-weight:900">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¢Ù…Ù†Ø©</div><div class="note">Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙˆØ§ÙÙ‚ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±</div></div></div>
          <div class="quick-card"><div class="quick-icon">âš¡</div><div><div style="font-weight:900">ÙˆØ§Ø¬Ù‡Ø© Ø³Ø±ÙŠØ¹Ø©</div><div class="note">ØªØµÙ…ÙŠÙ… Ù…ØªØ·ÙˆØ± ÙˆÙ…Ø¤Ø«Ø±Ø§Øª Ø³Ù„Ø³Ø©</div></div></div>
        </div>
      </div>

      <div class="hero-right">
        <img src="https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?q=80&w=900&auto=format&fit=crop" alt="hero" style="width:100%;height:220px;object-fit:cover;border-radius:12px;box-shadow:0 10px 28px rgba(12,28,36,0.08)" />
      </div>
    </section>

    <!-- CATEGORIES (framed) -->
    <div class="categories" id="categoriesContainer">
      <!-- generated from JS -->
    </div>

    <!-- FILTERS/CONTROLS -->
    <div style="display:flex; gap:12px; align-items:center; margin:8px 0;">
      <div style="font-weight:900; color:#234">Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©: <span id="cntVal">0</span></div>
      <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
        <select id="sortSelect" class="input" style="width:auto; padding:8px;">
          <option value="recent">Ø§Ù„Ø£Ø­Ø¯Ø«</option>
          <option value="price-asc">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„</option>
          <option value="price-desc">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰</option>
        </select>
      </div>
    </div>

    <!-- GRID -->
    <section>
      <div class="grid" id="propertiesGrid" aria-live="polite"></div>
    </section>

    <footer>
      Â© 2025 Ø§Ù„Ù†Ø®Ø¨Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© â€” ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© â€” Ø¬Ø§Ù‡Ø² Ù„Ù„Ø±Ø¨Ø· Ø¨Ù€ Firebase Ø¹Ù†Ø¯ Ø§Ù„Ø±ØºØ¨Ø©.
    </footer>
  </div>

  <!-- =========================
       PAGES: detailPage, addPage, adminPage
       ========================= -->

  <!-- DETAIL PAGE -->
  <div id="detailPage" class="page" aria-hidden="true" style="padding:28px;">
    <div class="container">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
        <div>
          <button class="btn" onclick="goHome()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        </div>
        <div style="text-align:left;">
          <div class="note">Ø¹Ø±Ø¶ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¹Ù‚Ø§Ø±</div>
        </div>
      </div>

      <div class="detail-page" id="detailContentArea">
        <!-- left gallery -->
        <div class="detail-gallery">
          <div class="detail-main" id="detailMainWrap"><img id="detailMainImage" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±"></div>
          <div class="detail-thumbs" id="detailThumbs"></div>
        </div>

        <!-- right info -->
        <div class="detail-info">
          <h3 id="dTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±</h3>
          <div class="info-box"><span class="label">Ø§Ù„Ù…ÙˆÙ‚Ø¹</span><div id="dLocation">-</div></div>
          <div class="info-box"><span class="label">Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ù…Ø³Ø§Ø­Ø©</span><div style="display:flex;justify-content:space-between;"><div id="dPrice">0 Ø±.Ø³</div><div id="dArea">- Ù…Â²</div></div></div>
          <div class="info-box"><span class="label">Ø­Ø§Ù„Ø© Ø§Ù„ØµÙƒ / Ø§Ù„Ø¨Ù†Ùƒ</span><div id="dDeed">-</div></div>
          <div class="info-box"><span class="label">Ø§Ù„Ø¨Ø§Ù‚Ø©</span><div id="dPackage">Basic</div></div>
          <div class="info-box"><span class="label">Ø§Ù„ÙˆØµÙ</span><div id="dDesc" class="desc">-</div></div>

          <div style="display:flex; gap:10px; align-items:center; margin-top:6px;">
            <a id="dWhatsapp" class="btn btn-primary" target="_blank" rel="noopener noreferrer">Ù…Ø±Ø§Ø³Ù„Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ (Ù„Ù„Ù…Ø¯ÙŠØ±)</a>
            <button class="btn btn-ghost" onclick="goHome()">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
          </div>

          <div class="note" style="margin-top:8px;">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø±Ù‚Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ Ù„Ø§ ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¹Ø§Ù…Ø© â€” ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.</div>

        </div>
      </div>
    </div>
  </div>

  <!-- ADD PAGE (ØµÙØ­Ø© Ù…Ù†ÙØµÙ„Ø©) -->
  <div id="addPage" class="page" aria-hidden="true" style="padding:28px;">
    <div class="container">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
        <div>
          <button class="btn" onclick="goHome()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        </div>
        <div style="text-align:left;">
          <div class="note">ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø± Ù…ØªÙƒØ§Ù…Ù„Ø© â€” Ù†Ø´Ø± ÙŠÙ†ØªØ¸Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</div>
        </div>
      </div>

      <div class="add-page">
        <div>
          <div style="background:linear-gradient(180deg,#fff,#fbfeff); padding:16px; border-radius:12px; border:1px solid rgba(8,20,28,0.03); box-shadow:0 10px 30px rgba(12,28,36,0.06);">
            <h3>Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø±</h3>
            <p class="note">Ø§Ø±ÙØ¹ Ø­ØªÙ‰ 3 ØµÙˆØ± (Ø§Ù„Ø£ÙˆÙ„Ù‰: ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±). Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙŠØµÙ„ Ù„Ù„Ù…Ø¯ÙŠØ± Ø¨Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±.</p>

            <form id="addFormFull" onsubmit="onSubmitAddFull(event)">
              <div class="form-grid">
                <label>Ø§Ù„ØµÙˆØ± (Ø­ØªÙ‰ 3 ØµÙˆØ±)</label>
                <input type="file" id="addImagesInput" accept="image/*" multiple />
                <div class="images-preview" id="addImagesPreview"></div>

                <label>Ø§Ù„Ø¨Ø§Ù‚Ø©</label>
                <select id="inputPackage" class="input">
                  <option value="basic">Basic</option>
                  <option value="featured">Featured</option>
                  <option value="premium">Premium</option>
                </select>

                <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø±Ø¶</label>
                <input id="inputTitleFull" class="input" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù…Ø§Ø±Ø© Ø¯ÙˆØ±ÙŠÙ† - Ø¹Ù„Ù‰ Ø´Ø§Ø±Ø¹ Ø±Ø¦ÙŠØ³ÙŠ" required />

                <label>Ø§Ù„Ù‚Ø³Ù…</label>
                <select id="inputCategoryFull" class="input" required>
                  <option value="ÙÙ„Ù„">ÙÙ„Ù„</option>
                  <option value="Ø´Ù‚Ù‚">Ø´Ù‚Ù‚</option>
                  <option value="Ø¹Ù…Ø§Ø¦Ø±">Ø¹Ù…Ø§Ø¦Ø±</option>
                  <option value="Ø£Ø±Ø§Ø¶ÙŠ">Ø£Ø±Ø§Ø¶ÙŠ</option>
                  <option value="Ø§Ø³ØªØ±Ø§Ø­Ø§Øª">Ø§Ø³ØªØ±Ø§Ø­Ø§Øª</option>
                  <option value="Ø£Ø¯ÙˆØ§Ø± Ù…Ø³ØªÙ‚Ù„Ø©">Ø£Ø¯ÙˆØ§Ø± Ù…Ø³ØªÙ‚Ù„Ø©</option>
                </select>

                <label>Ø§Ù„Ø³Ø¹Ø± (Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©)</label>
                <input id="inputPriceFull" class="input" placeholder="Ù…Ø«Ø§Ù„: 1500000" inputmode="numeric" pattern="[0-9]*" required />

                <label>Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)</label>
                <input id="inputAreaFull" class="input" placeholder="Ù…Ø«Ø§Ù„: 450" inputmode="numeric" pattern="[0-9]*" required />

                <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ù†ØµÙŠÙ‹Ø§)</label>
                <input id="inputLocationFull" class="input" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø­ÙˆÙŠØ©ØŒ Ø§Ù„Ø±ÙŠØ§Ø¶ - Ù‚Ø±ÙŠØ¨ Ø¬Ø§Ù…Ø¹ Ø§Ù„Ø³Ù…Ø§Ø­" required />

                <label>Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ù…Ø§Ù„Ùƒ</label>
                <input id="inputOwnerPhoneFull" class="input" placeholder="Ù…Ø«Ø§Ù„: 0551234567" required />

                <label>Ù‡Ù„ Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨ØµÙƒØŸ</label>
                <select id="inputDeedFull" class="input">
                  <option value="Ù„Ø§">Ù„Ø§</option>
                  <option value="Ù†Ø¹Ù…">Ù†Ø¹Ù…</option>
                </select>

                <div id="bankWrapperFull" style="display:none;">
                  <label>Ù‡Ù„ ÙŠÙ‚Ø¨Ù„ Ø§Ù„Ø¨Ù†ÙƒØŸ</label>
                  <select id="inputBankFull" class="input">
                    <option value="Ù„Ø§">Ù„Ø§</option>
                    <option value="Ù†Ø¹Ù…">Ù†Ø¹Ù…</option>
                  </select>
                </div>

                <label>ÙˆØµÙ ÙƒØ§Ù…Ù„ Ù„Ù„Ø¹Ù‚Ø§Ø±</label>
                <textarea id="inputDescFull" placeholder="ÙˆØµÙ ÙƒØ§Ù…Ù„ ÙˆÙ…ÙØµÙ„ Ù„Ù„Ø¹Ù‚Ø§Ø±"></textarea>

                <div style="display:flex; gap:10px; margin-top:8px;">
                  <button class="btn btn-primary" type="submit">Ù†Ø´Ø± Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© (Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©)</button>
                  <button class="btn btn-ghost" type="button" onclick="goHome()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
              </div>
            </form>

          </div>
        </div>

        <div style="background:linear-gradient(180deg,#f7fbff,#ffffff); padding:16px; border-radius:12px; border:1px solid rgba(8,20,28,0.03); box-shadow:0 8px 20px rgba(12,28,36,0.04);">
          <h4>Ù†ØµØ§Ø¦Ø­ Ø§Ø­ØªØ±Ø§ÙÙŠØ©</h4>
          <ul style="color:#556; line-height:1.6;">
            <li>Ø£ÙˆÙ„ ØµÙˆØ±Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±.</li>
            <li>Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© â€” Featured ÙŠØ²ÙŠØ¯ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨ØµØ±ÙŠÙ‹Ø§.</li>
            <li>Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ¨Ø¯ÙˆÙ† ÙÙˆØ§ØµÙ„.</li>
            <li>Ø£Ø¯Ø®Ù„ ÙˆØµÙÙ‹Ø§ ÙˆØ§Ø¶Ø­Ù‹Ø§ ÙˆÙ…ÙØµÙ„Ø§Ù‹ Ù„Ø±ÙØ¹ ÙØ±Øµ Ø§Ù„Ø¨ÙŠØ¹.</li>
          </ul>
        </div>
      </div>

    </div>
  </div>

  <!-- ADMIN PAGE (ØµÙØ­Ø© Ù…Ù†ÙØµÙ„Ø© ÙƒØ§Ù…Ù„Ø©) -->
  <div id="adminPage" aria-hidden="true">
    <div class="admin-shell">
      <div class="admin-head">
        <div>
          <h2 style="margin:0">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± â€” Ø§Ù„Ù†Ø®Ø¨Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</h2>
          <div style="color:#667; font-size:0.95rem; margin-top:6px">ØµÙØ­Ø© Ø®Ø§ØµØ© Ù„Ù„Ù…Ø¯ÙŠØ±: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª (Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© - Ø§Ù„Ù…Ù„Ø§Ùƒ - Ø¹Ù‚Ø§Ø±Ø§ØªÙŠ).</div>
        </div>
        <div style="display:flex; gap:10px; align-items:center;">
          <button class="btn" onclick="goHome()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹</button>
          <button class="btn btn-primary" onclick="adminCreateProperty()">Ø£Ø¶Ù ÙƒÙ…Ø¯ÙŠØ±</button>
          <button class="btn btn-ghost" id="btnLogoutAdmin">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>

      <div style="display:flex; gap:12px; align-items:center; margin-bottom:12px;">
        <div class="tabs">
          <div class="tab active" data-tab="pending">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</div>
          <div class="tab" data-tab="owners">Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù„Ø§Ùƒ</div>
          <div class="tab" data-tab="admin">Ø¹Ù‚Ø§Ø±Ø§ØªÙŠ (Ø§Ù„Ù…Ø¯ÙŠØ±)</div>
        </div>
        <div style="margin-left:auto;">
          <input id="adminSearch" class="input" placeholder="Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±..." style="width:260px;padding:8px;">
        </div>
      </div>

      <div id="adminContent">
        <div id="tab-pending" class="admin-grid">
          <h4>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</h4>
          <table class="admin-table" id="pendingTable">
            <thead><tr><th>Ø±Ù‚Ù…</th><th>Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ù…Ø§Ù„Ùƒ</th><th>Ø¨Ø§Ù‚Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div id="tab-owners" class="admin-grid" style="display:none;">
          <h4>Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù„Ø§Ùƒ</h4>
          <table class="admin-table" id="ownersTable"><thead><tr><th>Ø±Ù‚Ù…</th><th>Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ù…Ø§Ù„Ùƒ (Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©)</th><th>Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody></tbody></table>
        </div>

        <div id="tab-admin" class="admin-grid" style="display:none;">
          <h4>Ø¹Ù‚Ø§Ø±Ø§ØªÙŠ (Ø§Ù„Ù…Ø¯ÙŠØ±)</h4>
          <table class="admin-table" id="adminTable"><thead><tr><th>Ø±Ù‚Ù…</th><th>Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody></tbody></table>
        </div>
      </div>
    </div>
  </div>

<script>
/* ===========================================================
   Data model (localStorage), helpers and sample data
   =========================================================== */
const STORAGE_KEY = 'alq_properties_v3';
const NEXT_ID_KEY = 'alq_nextid_v3';
const ADMIN_USERNAME = 'IVL511';
const ADMIN_PASSWORD = 'IVL511';
const ADMIN_WHATSAPP = '966535342404';

let properties = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null') || [];
let nextId = parseInt(localStorage.getItem(NEXT_ID_KEY) || '1', 10);
function persist(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(properties)); localStorage.setItem(NEXT_ID_KEY, String(nextId)); }
function $(id){ return document.getElementById(id); }
function el(tag, attrs={}, ...children){ const e=document.createElement(tag); for(const k in attrs){ if(k==='class') e.className=attrs[k]; else if(k==='text') e.textContent=attrs[k]; else e.setAttribute(k, attrs[k]); } children.forEach(c=>{ if(typeof c==='string') e.appendChild(document.createTextNode(c)); else if(c) e.appendChild(c); }); return e; }
function formatNumber(n){ return Number(n).toLocaleString('en-US'); }

/* Seed sample data (if empty) */
function seed() {
  if(properties.length) return;
  const samples = [
    { title:"ÙÙŠÙ„Ø§ ÙØ§Ø®Ø±Ø© 5 ØºØ±Ù - Ø­ÙŠ Ø§Ù„Ù†Ø®ÙŠÙ„", category:"ÙÙ„Ù„", price:2500000, area:450, location:"Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø§Ù„Ù†Ø®ÙŠÙ„", ownerPhone:"0551234001", deed:"Ù†Ø¹Ù…", bank:"Ù†Ø¹Ù…", desc:"ÙÙŠÙ„Ø§ ÙØ§Ø®Ø±Ø© Ù…Ø¹ Ù…Ø³Ø¨Ø­ ÙˆØ­Ø¯ÙŠÙ‚Ø© ÙˆØºØ±ÙØ© Ø³Ø§Ø¦Ù‚.", images:["https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=1400&auto=format&fit=crop","https://images.unsplash.com/photo-1568605114967-8130f3a36994?q=80&w=1400&auto=format&fit=crop"], status:"approved", ownerType:"owner", package:"premium", createdAt:Date.now() },
    { title:"Ø´Ù‚Ø© Ø±Ø§Ù‚ÙŠØ© 3 ØºØ±Ù - Ø¨Ø±Ø¬ Ø§Ù„ÙØ¬Ø±", category:"Ø´Ù‚Ù‚", price:750000, area:150, location:"Ø¬Ø¯Ø© - Ø§Ù„Ø¨Ù„Ø¯", ownerPhone:"0551234002", deed:"Ù†Ø¹Ù…", bank:"Ù†Ø¹Ù…", desc:"Ø´Ù‚Ø© Ø­Ø¯ÙŠØ«Ø© Ø¶Ù…Ù† Ø¨Ø±Ø¬ Ù…Ø¹ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÙˆÙ…ÙˆÙ‚Ù Ø®Ø§Øµ.", images:["https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?q=80&w=1400&auto=format&fit=crop"], status:"approved", ownerType:"owner", package:"featured", createdAt:Date.now() },
    { title:"Ø§Ø³ØªØ±Ø§Ø­Ø© ÙØ§Ø®Ø±Ø© Ù…Ø¹ Ù…Ø³Ø¨Ø­", category:"Ø§Ø³ØªØ±Ø§Ø­Ø§Øª", price:950000, area:650, location:"Ø§Ù„Ø·Ø§Ø¦Ù - Ø§Ù„Ø®Ù…Ø±Ø©", ownerPhone:"0551234005", deed:"Ù†Ø¹Ù…", bank:"Ù„Ø§", desc:"Ø§Ø³ØªØ±Ø§Ø­Ø© Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù„Ø¹ÙˆØ§Ø¦Ù„ØŒ Ù…Ø³Ø¨Ø­ Ø®Ø§Øµ ÙˆØ§ØªØ³Ø§Ø¹", images:["https://images.unsplash.com/photo-1505691723518-36a3b7b1a5c5?q=80&w=1400&auto=format&fit=crop"], status:"approved", ownerType:"owner", package:"basic", createdAt:Date.now() },
    { title:"Ø£Ø±Ø¶ Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ© Ù‚Ø±Ø¨ Ø§Ù„Ø·Ø±ÙŠÙ‚", category:"Ø£Ø±Ø§Ø¶ÙŠ", price:5000000, area:1800, location:"Ø¬Ø¯Ø© - Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©", ownerPhone:"0551234004", deed:"Ù†Ø¹Ù…", bank:"Ù†Ø¹Ù…", desc:"Ø£Ø±Ø¶ Ø¨Ù…ÙˆÙ‚Ø¹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù…Ø´Ø±ÙˆØ¹ ØªØ¬Ø§Ø±ÙŠ.", images:["https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?q=80&w=1400&auto=format&fit=crop"], status:"approved", ownerType:"owner", package:"premium", createdAt:Date.now() },
    { title:"Ø¯ÙˆØ± Ù…Ø³ØªÙ‚Ù„ ÙˆØ§Ø³Ø¹ Ù„Ù„Ø¹Ø§Ø¦Ù„Ø§Øª", category:"Ø£Ø¯ÙˆØ§Ø± Ù…Ø³ØªÙ‚Ù„Ø©", price:600000, area:300, location:"Ø§Ù„Ø¯Ù…Ø§Ù… - Ø§Ù„Ø´Ø§Ø·Ø¦", ownerPhone:"0551234006", deed:"Ù†Ø¹Ù…", bank:"Ù†Ø¹Ù…", desc:"Ø¯ÙˆØ± Ù…Ø³ØªÙ‚Ù„ Ù…Ø¹ Ø­ÙˆØ´ ÙƒØ¨ÙŠØ± ÙˆÙ…ÙˆÙ‚Ø¹ Ù…Ù…ÙŠØ².", images:["https://images.unsplash.com/photo-1475855581690-80acc9d18e0a?q=80&w=1400&auto=format&fit=crop"], status:"approved", ownerType:"owner", package:"basic", createdAt:Date.now() },
    { title:"Ø´Ù‚Ø© Ù„Ù„Ø¥ÙŠØ¬Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯", category:"Ø´Ù‚Ù‚", price:320000, area:95, location:"ØªØ¨ÙˆÙƒ - Ø§Ù„Ø³ÙˆÙŠÙ‚Ø©", ownerPhone:"0551234007", deed:"Ù„Ø§", bank:"Ù„Ø§", desc:"Ø´Ù‚Ø© Ø­Ø¯ÙŠØ«Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø³ÙƒÙ†ØŒ Ù…ÙˆÙ‚Ù ÙˆÙ…ØµØ¹Ø¯.", images:["https://images.unsplash.com/photo-1560449753-74f0c2b1f16a?q=80&w=1400&auto=format&fit=crop"], status:"pending", ownerType:"owner", package:"basic", createdAt:Date.now() },
    { title:"Ø¹Ù…Ø§Ø±Ø© Ù„Ù„ØªØ±Ù…ÙŠÙ… - ÙØ±ØµØ©", category:"Ø¹Ù…Ø§Ø¦Ø±", price:1450000, area:520, location:"Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© - Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©", ownerPhone:"0551234008", deed:"Ù†Ø¹Ù…", bank:"Ù„Ø§", desc:"Ø¹Ù…Ø§Ø±Ø© ØªØ­ØªØ§Ø¬ ØªØ±Ù…ÙŠÙ…ØŒ ÙØ±ØµØ© Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©.", images:["https://images.unsplash.com/photo-1549187774-b4e9b0445b6b?q=80&w=1400&auto=format&fit=crop"], status:"pending", ownerType:"owner", package:"featured", createdAt:Date.now() }
  ];
  samples.forEach(s => { s.id = nextId++; properties.push(s); });
  persist();
}
seed();

/* ===========================================================
   CATEGORIES UI
   =========================================================== */
const categoriesMeta = [
  {key:'all', title:'Ø§Ù„ÙƒÙ„', subtitle:'Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª', color:'#7ec6ff', icon:'ğŸ·ï¸'},
  {key:'ÙÙ„Ù„', title:'ÙÙ„Ù„', subtitle:'Ø¹Ù‚Ø§Ø±Ø§Øª Ø³ÙƒÙ†ÙŠØ© ÙØ§Ø®Ø±Ø©', color:'#ff8a65', icon:'ğŸ '},
  {key:'Ø´Ù‚Ù‚', title:'Ø´Ù‚Ù‚', subtitle:'Ø´Ù‚Ù‚ Ø³ÙƒÙ†ÙŠØ©', color:'#6dd3ff', icon:'ğŸ¢'},
  {key:'Ø¹Ù…Ø§Ø¦Ø±', title:'Ø¹Ù…Ø§Ø¦Ø±', subtitle:'Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©', color:'#ffd166', icon:'ğŸ¬'},
  {key:'Ø£Ø±Ø§Ø¶ÙŠ', title:'Ø£Ø±Ø§Ø¶ÙŠ', subtitle:'Ù‚Ø·Ø¹ Ø£Ø±Ø§Ø¶ÙŠ', color:'#b388ff', icon:'ğŸŒ±'},
  {key:'Ø§Ø³ØªØ±Ø§Ø­Ø§Øª', title:'Ø§Ø³ØªØ±Ø§Ø­Ø§Øª', subtitle:'Ù…Ù†Ø§Ø·Ù‚ Ø§Ø³ØªØ¬Ù…Ø§Ù…', color:'#87f0d8', icon:'ğŸ–ï¸'},
  {key:'Ø£Ø¯ÙˆØ§Ø± Ù…Ø³ØªÙ‚Ù„Ø©', title:'Ø£Ø¯ÙˆØ§Ø± Ù…Ø³ØªÙ‚Ù„Ø©', subtitle:'Ø£Ø¯ÙˆØ§Ø± Ù„Ù„Ø¹Ø§Ø¦Ù„Ø§Øª', color:'#a3d39c', icon:'ğŸ¡'},
];

function renderCategories() {
  const container = $('categoriesContainer'); container.innerHTML = '';
  categoriesMeta.forEach(cat => {
    const frame = el('div',{class:'cat-frame', 'data-cat': cat.key});
    const icon = el('div',{class:'cat-icon'}, cat.icon);
    icon.style.background = `linear-gradient(135deg, ${cat.color}, rgba(255,255,255,0.12))`;
    const txt = el('div',{}, el('div',{class:'cat-title', text:cat.title}), el('div',{class:'cat-sub', text:cat.subtitle}));
    frame.appendChild(icon); frame.appendChild(txt);
    frame.onclick = ()=> {
      document.querySelectorAll('.cat-frame').forEach(x=>x.classList.remove('active'));
      frame.classList.add('active');
      renderAll();
    };
    container.appendChild(frame);
  });
  // set first to active
  const first = container.querySelector('[data-cat="all"]');
  if(first) first.classList.add('active');
}
renderCategories();

/* ===========================================================
   RENDER GRID & CARDS
   =========================================================== */
function ribbonClass(pkg){
  if(pkg === 'premium') return 'ribbon premium';
  if(pkg === 'featured') return 'ribbon featured';
  return 'ribbon basic';
}

function createCard(prop){
  const card = el('article',{class:'card','data-id':prop.id});
  const media = el('div',{class:'card-media'});
  const img = el('img'); img.src = (prop.images && prop.images.length) ? prop.images[0] : placeholder();
  media.appendChild(img);
  const rib = el('div',{class: ribbonClass(prop.package || 'basic')}, (prop.package || 'basic').toUpperCase());
  media.appendChild(rib);

  const body = el('div',{class:'card-body'});
  const title = el('h4',{class:'card-title'}, prop.title);
  const loc = el('div',{class:'card-loc'}, prop.location);
  const meta = el('div',{class:'card-meta'});
  const price = el('div',{class:'price'}, formatNumber(prop.price)+' Ø±.Ø³');
  const area = el('div',{class:'meta-small'}, (prop.area || '-') + ' Ù…Â²');
  meta.appendChild(price); meta.appendChild(area);

  const footer = el('div',{class:'card-footer'});
  const btnView = el('button',{class:'btn-small btn-view'}, 'Ø¹Ø±Ø¶');
  btnView.onclick = ()=> openDetailPage(prop.id);
  const btnWT = el('button',{class:'btn-small btn-contact'}, 'ÙˆØ§ØªØ³Ø§Ø¨');
  btnWT.onclick = ()=> {
    const text = `Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø£Ø¹Ø¬Ø¨Ù†ÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±: ${prop.title} (Ø±Ù‚Ù… ${prop.id})\nØ§Ù„Ù…ÙˆÙ‚Ø¹: ${prop.location}\nØ§Ù„Ø³Ø¹Ø±: ${formatNumber(prop.price)} Ø±.Ø³`;
    window.open(`https://wa.me/${ADMIN_WHATSAPP}?text=${encodeURIComponent(text)}`, '_blank');
  };
  footer.appendChild(btnView); footer.appendChild(btnWT);

  body.appendChild(title); body.appendChild(loc); body.appendChild(meta); body.appendChild(footer);
  card.appendChild(media); card.appendChild(body);
  return card;
}

function getActiveCategory(){
  const ele = document.querySelector('.cat-frame.active');
  return ele ? ele.getAttribute('data-cat') : 'all';
}

function renderGrid(filter='all', query='', sortBy='recent'){
  const grid = $('propertiesGrid'); grid.innerHTML = '';
  let list = properties.filter(p => p.status === 'approved');
  if(filter && filter !== 'all') list = list.filter(p => p.category === filter);
  if(query) {
    const q = query.toLowerCase();
    list = list.filter(p => ((p.title||'') + ' ' + (p.location||'') + ' ' + (p.desc||'')).toLowerCase().includes(q));
  }
  if(sortBy === 'price-asc') list.sort((a,b)=>a.price-b.price);
  else if(sortBy === 'price-desc') list.sort((a,b)=>b.price-a.price);
  else list.sort((a,b)=>b.createdAt - a.createdAt);

  $('cntVal').textContent = list.length;
  if(!list.length){ grid.appendChild(el('div', {style:'padding:20px;color:#556'}, 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù‚Ø§Ø±Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù….')); return; }
  list.forEach(p => grid.appendChild(createCard(p)));
}

/* ===========================================================
   NAVIGATION: pages (home, detail, add, admin)
   =========================================================== */
function goHome(){
  // hide all pages
  document.querySelectorAll('.page').forEach(p => p.classList.remove('show'));
  $('detailPage').style.display = 'none';
  $('addPage').style.display = 'none';
  $('adminPage').style.display = 'none';
  $('mainContent').style.display = 'block';
  // reset active category highlight if none set
  renderCategories(); // ensure categories present
  // show top actions accordingly
  $('btnSiteEdit').style.display = isAdminLogged() ? 'inline-block' : 'none';
  $('btnLogin').style.display = isAdminLogged() ? 'none' : 'inline-block';
  renderAll();
}
window.goHome = goHome;

/* ===========================================================
   DETAIL PAGE (ØµÙØ­Ø© Ù…Ù†ÙØµÙ„Ø©)
   =========================================================== */
function openDetailPage(id){
  const prop = properties.find(p=>p.id==id); if(!prop) return;
  // populate
  $('dTitle').textContent = prop.title;
  $('dLocation').textContent = prop.location;
  $('dPrice').textContent = formatNumber(prop.price) + ' Ø±.Ø³';
  $('dArea').textContent = (prop.area || '-') + ' Ù…Â²';
  $('dDesc').textContent = prop.desc || '-';
  $('dDeed').textContent = `Ø§Ù„ØµÙƒ: ${prop.deed || 'Ù„Ø§'} â€” Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¨Ù†Ùƒ: ${prop.bank || 'Ù„Ø§'}`;
  $('dPackage').textContent = (prop.package || 'basic').toUpperCase();

  // images
  const main = $('detailMainImage');
  const thumbs = $('detailThumbs'); thumbs.innerHTML = '';
  const imgs = (prop.images && prop.images.length) ? prop.images : [placeholder()];
  main.src = imgs[0];
  imgs.forEach((s,i)=>{ const im = document.createElement('img'); im.src = s; if(i===0) im.classList.add('active'); im.onclick = ()=>{ main.src = s; thumbs.querySelectorAll('img').forEach(x=>x.classList.remove('active')); im.classList.add('active'); }; thumbs.appendChild(im); });

  // whatsapp link -> admin with property id and title
  const msg = `Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø£Ø¹Ø¬Ø¨Ù†ÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±: ${prop.title} (Ø±Ù‚Ù… ${prop.id})\nØ§Ù„Ù…ÙˆÙ‚Ø¹: ${prop.location}\nØ§Ù„Ø³Ø¹Ø±: ${formatNumber(prop.price)} Ø±.Ø³`;
  $('dWhatsapp').href = `https://wa.me/${ADMIN_WHATSAPP}?text=${encodeURIComponent(msg)}`;

  // navigation: hide main, show detail
  $('mainContent').style.display = 'none';
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('show'));
  $('detailPage').classList.add('show');
  $('detailPage').style.display = 'block';
}

/* ===========================================================
   ADD PAGE (ØµÙØ­Ø© Ù…Ù†ÙØµÙ„Ø©) - upload preview + form
   =========================================================== */
let addSelectedImgs = [];
$('btnShowAdd').addEventListener('click', ()=> {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('show'));
  $('mainContent').style.display = 'none';
  $('addPage').classList.add('show'); $('addPage').style.display = 'block';
  // reset form
  $('addFormFull').reset(); $('addImagesPreview').innerHTML = ''; addSelectedImgs = [];
});

$('addImagesInput').addEventListener('change', function(e){
  const files = Array.from(e.target.files).slice(0,3); addSelectedImgs = []; $('addImagesPreview').innerHTML = '';
  files.forEach(file => {
    const r = new FileReader();
    r.onload = function(ev){
      addSelectedImgs.push(ev.target.result);
      const slot = el('div',{class:'img-slot'}); const img = el('img'); img.src = ev.target.result; slot.appendChild(img); $('addImagesPreview').appendChild(slot);
    };
    r.readAsDataURL(file);
  });
});

$('inputDeedFull').addEventListener('change', function(){
  $('bankWrapperFull').style.display = (this.value === 'Ù†Ø¹Ù…') ? 'block' : 'none';
});

function onSubmitAddFull(e){
  e.preventDefault();
  if(addSelectedImgs.length < 1){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ (Ø§Ù„Ø£ÙˆÙ„Ù‰: ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±).'); return; }
  if(addSelectedImgs.length > 3){ alert('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 3 ØµÙˆØ±.'); return; }
  const pkg = $('inputPackage').value || 'basic';
  const title = $('inputTitleFull').value.trim();
  const cat = $('inputCategoryFull').value;
  const price = Number($('inputPriceFull').value);
  const area = Number($('inputAreaFull').value);
  const location = $('inputLocationFull').value.trim();
  const ownerPhone = $('inputOwnerPhoneFull').value.trim();
  const deed = $('inputDeedFull').value;
  const bank = $('inputBankFull').value || 'Ù„Ø§';
  const desc = $('inputDescFull').value.trim();
  if(!title || !cat || !price || !location || !ownerPhone){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.'); return; }
  const prop = { id: nextId++, title, category:cat, price, area, location, ownerPhone, deed, bank, desc, images: addSelectedImgs.slice(0,3), status:'pending', ownerType:'owner', package:pkg, createdAt:Date.now() };
  properties.push(prop); persist();
  alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø©.');
  goHome();
  renderAll(); if(isAdminLogged()) renderAdminTables();
}

/* ===========================================================
   LOGIN / ADMIN logic (admin page separate)
   =========================================================== */
$('btnLogin').addEventListener('click', ()=> {
  // show a simple prompt (no credentials displayed publicly)
  const user = prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:');
  if(!user) return;
  const pass = prompt('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:');
  if(!pass) return;
  if(user === ADMIN_USERNAME && pass === ADMIN_PASSWORD){
    sessionStorage.setItem('alq_admin_logged','true');
    // show admin page
    openAdmin();
    alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ±.');
  } else {
    alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø®ÙˆÙ„ Ø®Ø§Ø·Ø¦Ø©.');
  }
});

function isAdminLogged(){ return sessionStorage.getItem('alq_admin_logged') === 'true'; }

function openAdmin(){
  // hide main content & show admin page
  $('mainContent').style.display = 'none';
  $('adminPage').style.display = 'block';
  $('btnSiteEdit').style.display = 'inline-block';
  document.getElementById('btnLogin').style.display = 'none';
  renderAdminTables();
}

/* Logout admin */
$('btnLogoutAdmin').addEventListener('click', function(){
  if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')){
    sessionStorage.removeItem('alq_admin_logged');
    $('adminPage').style.display = 'none';
    $('mainContent').style.display = 'block';
    $('btnSiteEdit').style.display = 'none';
    document.getElementById('btnLogin').style.display = 'inline-block';
    renderAll();
    alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬.');
  }
});

/* Admin: create as admin */
let adminCreateFlag = false;
function adminCreateProperty(){
  adminCreateFlag = true;
  // open add page â€” after submit, onSubmitAddFull checks adminCreateFlag
  $('btnShowAdd').click();
}

/* Override onSubmitAddFull to support adminCreateFlag */
const originalOnSubmitAddFull = onSubmitAddFull;
onSubmitAddFull = function(e){
  // same validation but set ownerType
  e.preventDefault();
  if(addSelectedImgs.length < 1){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ (Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø£ÙˆÙ„Ø§Ù‹).'); return; }
  if(addSelectedImgs.length > 3){ alert('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 3 ØµÙˆØ±.'); return; }
  const pkg = $('inputPackage').value || 'basic';
  const title = $('inputTitleFull').value.trim();
  const cat = $('inputCategoryFull').value;
  const price = Number($('inputPriceFull').value);
  const area = Number($('inputAreaFull').value);
  const location = $('inputLocationFull').value.trim();
  const ownerPhone = $('inputOwnerPhoneFull').value.trim();
  const deed = $('inputDeedFull').value;
  const bank = $('inputBankFull').value || 'Ù„Ø§';
  const desc = $('inputDescFull').value.trim();
  if(!title || !cat || !price || !location || !ownerPhone){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.'); return; }
  const prop = { id: nextId++, title, category:cat, price, area, location, ownerPhone, deed, bank, desc, images: addSelectedImgs.slice(0,3), status: adminCreateFlag ? 'approved' : 'pending', ownerType: adminCreateFlag ? 'admin' : 'owner', package:pkg, createdAt:Date.now() };
  properties.push(prop); persist();
  adminCreateFlag = false;
  alert(prop.status === 'approved' ? 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆÙ†Ø´Ø±Ù‡.' : 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¹Ù‚Ø§Ø± Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯ÙŠØ±.');
  goHome();
  renderAll();
  if(isAdminLogged()) renderAdminTables();
};

/* ===========================================================
   ADMIN TABLES rendering & actions
   =========================================================== */
function renderAdminTables(searchFilter=''){
  // pending
  const pendings = properties.filter(p => p.status === 'pending');
  const pendingTbody = document.querySelector('#pendingTable tbody'); pendingTbody.innerHTML = '';
  pendings.filter(p => matchesFilter(p, searchFilter)).forEach(p=>{
    const tr = el('tr');
    tr.appendChild(el('td',{}, p.id));
    tr.appendChild(el('td',{}, p.title));
    tr.appendChild(el('td',{}, p.category));
    tr.appendChild(el('td',{}, formatNumber(p.price)+' Ø±.Ø³'));
    tr.appendChild(el('td',{}, p.ownerPhone));
    tr.appendChild(el('td',{}, (p.package || 'basic').toUpperCase()));
    const td = el('td', {});
    const btnApprove = el('button', {class:'btn btn-primary'}, 'Ù…ÙˆØ§ÙÙ‚Ø©'); btnApprove.onclick = ()=> { approveProperty(p.id); };
    const btnReject = el('button', {class:'btn btn-ghost'}, 'Ø±ÙØ¶'); btnReject.onclick = ()=> { if(confirm('Ø±ÙØ¶ ÙˆØ­Ø°ÙØŸ')) deleteById(p.id); };
    const btnView = el('button',{class:'btn btn-ghost'}, 'Ø¹Ø±Ø¶'); btnView.onclick = ()=> openDetailPage(p.id);
    const btnEdit = el('button',{class:'btn btn-ghost'}, 'ØªØ¹Ø¯ÙŠÙ„'); btnEdit.onclick = ()=> openEditFromAdmin(p.id);
    td.appendChild(btnApprove); td.appendChild(btnReject); td.appendChild(btnEdit); td.appendChild(btnView);
    tr.appendChild(td); pendingTbody.appendChild(tr);
  });

  // owners (approved ones or all owners)
  const ownersTbody = document.querySelector('#ownersTable tbody'); ownersTbody.innerHTML = '';
  const owners = properties.filter(p => p.ownerType === 'owner');
  owners.filter(p => matchesFilter(p, searchFilter)).forEach(p=>{
    const tr = el('tr');
    tr.appendChild(el('td',{}, p.id));
    tr.appendChild(el('td',{}, p.title));
    tr.appendChild(el('td',{}, p.category));
    tr.appendChild(el('td',{}, formatNumber(p.price)+' Ø±.Ø³'));
    tr.appendChild(el('td',{}, p.ownerPhone));
    tr.appendChild(el('td',{}, p.status));
    const td = el('td',{});
    const btnToggle = el('button',{class:'btn btn-primary'}, p.status === 'approved' ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„'); btnToggle.onclick = ()=> { p.status = (p.status === 'approved') ? 'pending' : 'approved'; persist(); renderAll(); renderAdminTables(); };
    const btnEdit = el('button',{class:'btn btn-ghost'}, 'ØªØ¹Ø¯ÙŠÙ„'); btnEdit.onclick = ()=> openEditFromAdmin(p.id);
    const btnDelete = el('button',{class:'btn btn-ghost'}, 'Ø­Ø°Ù'); btnDelete.onclick = ()=> { if(confirm('Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ')) deleteById(p.id); };
    td.appendChild(btnToggle); td.appendChild(btnEdit); td.appendChild(btnDelete);
    tr.appendChild(td); ownersTbody.appendChild(tr);
  });

  // admin's own properties
  const adminTbody = document.querySelector('#adminTable tbody'); adminTbody.innerHTML = '';
  const adminProps = properties.filter(p => p.ownerType === 'admin');
  adminProps.filter(p => matchesFilter(p, searchFilter)).forEach(p=>{
    const tr = el('tr');
    tr.appendChild(el('td',{}, p.id));
    tr.appendChild(el('td',{}, p.title));
    tr.appendChild(el('td',{}, p.category));
    tr.appendChild(el('td',{}, formatNumber(p.price)+' Ø±.Ø³'));
    tr.appendChild(el('td',{}, p.status));
    const td = el('td',{});
    const btnEdit = el('button',{class:'btn btn-ghost'}, 'ØªØ¹Ø¯ÙŠÙ„'); btnEdit.onclick = ()=> openEditFromAdmin(p.id);
    const btnDelete = el('button',{class:'btn btn-ghost'}, 'Ø­Ø°Ù'); btnDelete.onclick = ()=> { if(confirm('Ø­Ø°ÙØŸ')) deleteById(p.id); };
    td.appendChild(btnEdit); td.appendChild(btnDelete);
    tr.appendChild(td); adminTbody.appendChild(tr);
  });
}

/* helper filter */
function matchesFilter(p, q){
  if(!q) return true;
  q = q.toLowerCase();
  return (p.title||'').toLowerCase().includes(q) || (p.location||'').toLowerCase().includes(q) || String(p.id) === q || (p.ownerPhone||'').includes(q);
}

/* Approve / Delete / Edit */
function approveProperty(id){
  const p = properties.find(x=>x.id==id); if(!p) return;
  p.status = 'approved'; persist(); renderAll(); renderAdminTables(); alert('ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆÙ†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†.');
}
function deleteById(id){ properties = properties.filter(x=>x.id!=id); persist(); renderAll(); renderAdminTables(); alert('ØªÙ… Ø§Ù„Ø­Ø°Ù.'); }
function openEditFromAdmin(id){
  const p = properties.find(x=>x.id==id); if(!p) return;
  // fill add form for editing (simpler UX: go to addPage and prefill then save by replacing)
  document.querySelectorAll('.page').forEach(p => p.classList.remove('show'));
  $('mainContent').style.display = 'none';
  $('addPage').classList.add('show'); $('addPage').style.display = 'block';
  // prefill form fields
  adminEditMode = { enabled:true, id };
  $('inputPackage').value = p.package || 'basic';
  $('inputTitleFull').value = p.title;
  $('inputCategoryFull').value = p.category;
  $('inputPriceFull').value = p.price;
  $('inputAreaFull').value = p.area;
  $('inputLocationFull').value = p.location;
  $('inputOwnerPhoneFull').value = p.ownerPhone;
  $('inputDeedFull').value = p.deed;
  $('inputBankFull').value = p.bank || 'Ù„Ø§';
  $('inputDescFull').value = p.desc || '';
  $('addImagesPreview').innerHTML = '';
  addSelectedImgs = (p.images && p.images.length) ? p.images.slice() : [];
  addSelectedImgs.forEach(src => { const slot = el('div',{class:'img-slot'}); const img = el('img'); img.src = src; slot.appendChild(img); $('addImagesPreview').appendChild(slot); });
  $('bankWrapperFull').style.display = (p.deed === 'Ù†Ø¹Ù…') ? 'block' : 'none';
}
let adminEditMode = { enabled:false, id:null };
/* update add-submission to handle edit mode:
   on submit, if adminEditMode.enabled -> update existing property and reset adminEditMode */
const originalOnSubmitAddFull2 = onSubmitAddFull;
onSubmitAddFull = function(e){
  e.preventDefault();
  if(addSelectedImgs.length < 1){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ (Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø£ÙˆÙ„Ø§Ù‹).'); return; }
  if(addSelectedImgs.length > 3){ alert('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 3 ØµÙˆØ±.'); return; }
  const pkg = $('inputPackage').value || 'basic';
  const title = $('inputTitleFull').value.trim();
  const cat = $('inputCategoryFull').value;
  const price = Number($('inputPriceFull').value);
  const area = Number($('inputAreaFull').value);
  const location = $('inputLocationFull').value.trim();
  const ownerPhone = $('inputOwnerPhoneFull').value.trim();
  const deed = $('inputDeedFull').value;
  const bank = $('inputBankFull').value || 'Ù„Ø§';
  const desc = $('inputDescFull').value.trim();
  if(!title || !cat || !price || !location || !ownerPhone){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.'); return; }

  if(adminEditMode.enabled){
    const p = properties.find(x=>x.id == adminEditMode.id);
    if(!p) { alert('Ø®Ø·Ø£: Ø§Ù„Ø¹Ù‚Ø§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'); adminEditMode = {enabled:false,id:null}; return; }
    p.title = title; p.category = cat; p.price = price; p.area = area; p.location = location; p.ownerPhone = ownerPhone; p.deed = deed; p.bank = bank; p.desc = desc; p.images = addSelectedImgs.slice(0,3); p.package = pkg;
    persist();
    adminEditMode = { enabled:false, id:null };
    alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù‚Ø§Ø±.');
    goHome(); renderAll(); if(isAdminLogged()) renderAdminTables();
    return;
  }

  // normal add
  const prop = { id: nextId++, title, category:cat, price, area, location, ownerPhone, deed, bank, desc, images: addSelectedImgs.slice(0,3), status:'pending', ownerType:'owner', package:pkg, createdAt:Date.now() };
  properties.push(prop); persist();
  alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¹Ù‚Ø§Ø± Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯ÙŠØ±.');
  goHome(); renderAll(); if(isAdminLogged()) renderAdminTables();
};

/* ===========================================================
   SITE NAME edit (visible to admin only)
   =========================================================== */
$('btnSiteEdit').addEventListener('click', ()=> {
  const newName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯', $('siteNameDisplay').textContent);
  if(newName && newName.trim() !== '') {
    $('siteNameDisplay').textContent = newName.trim();
    $('logoText').textContent = newName.trim().split(' ').map(s=>s[0]).slice(0,3).join('');
  }
});

/* ===========================================================
   Util: placeholder image
   =========================================================== */
function placeholder(){ return 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='1400' height='800'><rect width='100%' height='100%' fill='#e9f0f5'/><text x='50%' y='50%' font-size='28' text-anchor='middle' fill='#9bb3c9' font-family='Arial' dy='.3em'>Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©</text></svg>`); }

/* ===========================================================
   INTERACTIONS: filtering, search, initial rendering
   =========================================================== */
function renderAll(){
  const cat = getActiveCategory();
  const q = $('globalSearch').value || '';
  const sort = $('sortSelect').value || 'recent';
  renderGrid(cat, q, sort);
  // admin UI visibility
  if(isAdminLogged()){
    $('btnSiteEdit').style.display = 'inline-block';
    document.getElementById('btnLogin').style.display = 'none';
  } else {
    $('btnSiteEdit').style.display = 'none';
    document.getElementById('btnLogin').style.display = 'inline-block';
  }
  if(document.querySelectorAll('.cat-frame').length === 0) renderCategories();
}
document.querySelectorAll('.cat-frame').forEach(p=>p.addEventListener('click', ()=> renderAll()));
$('globalSearch').addEventListener('input', ()=> setTimeout(renderAll, 200));
$('sortSelect').addEventListener('change', renderAll);

/* admin search filter */
$('adminSearch').addEventListener('input', function(){ renderAdminTables(this.value.trim().toLowerCase()); });

/* admin tab switching */
document.querySelectorAll('.tab').forEach(t => t.addEventListener('click', function(){
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  this.classList.add('active');
  const tab = this.getAttribute('data-tab');
  document.getElementById('tab-pending').style.display = (tab==='pending') ? 'block' : 'none';
  document.getElementById('tab-owners').style.display = (tab==='owners') ? 'block' : 'none';
  document.getElementById('tab-admin').style.display = (tab==='admin') ? 'block' : 'none';
}));

/* Close pages on Escape (fallback) */
document.addEventListener('keydown', function(e){
  if(e.key === 'Escape') goHome();
});

/* ===========================================================
   INIT
   =========================================================== */
renderAll();

</script>

</body>
</html>
